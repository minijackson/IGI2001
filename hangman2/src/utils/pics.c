#include "inc.h"

#include <stdio.h>
#include <unistd.h>
#include <sys/stat.h>
#include <string.h>

#include "pics.h"

bool havePicsFile = false;

char const* const hardcodedPictures[] = {
	"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
	"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n      ________________________________\n     /                                /|\n    /                                / |\n   /                                /  |\n  /                                /   |\n /                                /    |\n/________________________________/     |\n|                                |    /\n|                                |   /\n|                                |  /\n|                                | /\n|________________________________|/\n",
	"\n                   __\n                  /  \\\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n      ____________|  |________________\n     /            |  |                /|\n    /             |  |               / |\n   /              |__|              /  |\n  /                                /   |\n /                                /    |\n/________________________________/     |\n|                                |    /\n|                                |   /\n|                                |  /\n|                                | /\n|________________________________|/\n",
	"                    ___________________________________\n                   /  _________________________________)\n                  /  /  / /\n                  |  | / /\n                  |  |/ /\n                  |  | /\n                  |  |/\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n      ____________|  |________________\n     /            |  |                /|\n    /             |  |               / |\n   /              |__|              /  |\n  /                                /   |\n /                                /    |\n/________________________________/     |\n|                                |    /\n|                                |   /\n|                                |  /\n|                                | /\n|________________________________|/\n",
	"                    ___________________________________\n                   /  _________________________) )_____)\n                  /  /  / /                    | |\n                  |  | / /                     | |\n                  |  |/ /                      | |\n                  |  | /                       | |\n                  |  |/                        | |\n                  |  |                      ()(_)()\n                  |  |                    ()       ()\n                  |  |                   ()  X   X ()\n                  |  |                   ()(\\  __  ()\n                  |  |                    ()(\\_____|)\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n                  |  |\n      ____________|  |________________\n     /            |  |                /|\n    /             |  |               / |\n   /              |__|              /  |\n  /                                /   |\n /                                /    |\n/________________________________/     |\n|                                |    /\n|                                |   /\n|                                |  /\n|                                | /\n|________________________________|/\n",
	"                    ___________________________________\n                   /  _________________________) )_____)\n                  /  /  / /                    | |\n                  |  | / /                     | |\n                  |  |/ /                      | |\n                  |  | /                       | |\n                  |  |/                        | |\n                  |  |                      ()(_)()\n                  |  |                    ()       ()\n                  |  |                   ()  X   X ()\n                  |  |                   ()(\\  __  ()\n                  |  |                    ()(\\_____|)\n                  |  |                      __/ _ \\__\n                  |  |                      | \\( )/ |\n                  |  |                      |  \\_/  |\n                  |  |                      |   |   |\n                  |  |                      |   |   |\n                  |  |                      |   |   |\n                  |  |                      |___|___|\n      ____________|  |________________      |_______|\n     /            |  |                /|\n    /             |  |               / |\n   /              |__|              /  |\n  /                                /   |\n /                                /    |\n/________________________________/     |\n|                                |    /\n|                                |   /\n|                                |  /\n|                                | /\n|________________________________|/\n",
	"                    ___________________________________\n                   /  _________________________) )_____)\n                  /  /  / /                    | |\n                  |  | / /                     | |\n                  |  |/ /                      | |\n                  |  | /                       | |\n                  |  |/                        | |\n                  |  |                      ()(_)()\n                  |  |                    ()       ()\n                  |  |                   ()  X   X ()\n                  |  |                   ()(\\  __  ()\n                  |  |                    ()(\\_____|)\n                  |  |                     ___/ _ \\__\n                  |  |                    /   \\( )/ |\n                  |  |                   /  |  \\_/  |\n                  |  |                   |  |   |   |\n                  |  |                   |  |   |   |\n                  |  |                   |  |   |   |\n                  |  |                   |__|___|___|\n      ____________|  |________________   |  |_______|\n     /            |  |                /|  WW\n    /             |  |               / |\n   /              |__|              /  |\n  /                                /   |\n /                                /    |\n/________________________________/     |\n|                                |    /\n|                                |   /\n|                                |  /\n|                                | /\n|________________________________|/\n",
	"                    ___________________________________\n                   /  _________________________) )_____)\n                  /  /  / /                    | |\n                  |  | / /                     | |\n                  |  |/ /                      | |\n                  |  | /                       | |\n                  |  |/                        | |\n                  |  |                      ()(_)()\n                  |  |                    ()       ()\n                  |  |                   ()  X   X ()\n                  |  |                   ()(\\  __  ()\n                  |  |                    ()(\\_____|)\n                  |  |                     ___/ _ \\___\n                  |  |                    /   \\( )/   \\\n                  |  |                   /  |  \\_/  |  \\\n                  |  |                   |  |   |   |  |\n                  |  |                   |  |   |   |  |\n                  |  |                   |  |   |   |  |\n                  |  |                   |__|___|___|__|\n      ____________|  |________________   |  |_______|  |\n     /            |  |                /|  WW         WW\n    /             |  |               / |\n   /              |__|              /  |\n  /                                /   |\n /                                /    |\n/________________________________/     |\n|                                |    /\n|                                |   /\n|                                |  /\n|                                | /\n|________________________________|/\n",
	"                    ___________________________________\n                   /  _________________________) )_____)\n                  /  /  / /                    | |\n                  |  | / /                     | |\n                  |  |/ /                      | |\n                  |  | /                       | |\n                  |  |/                        | |\n                  |  |                      ()(_)()\n                  |  |                    ()       ()\n                  |  |                   ()  X   X ()\n                  |  |                   ()(\\  __  ()\n                  |  |                    ()(\\_____|)\n                  |  |                     ___/ _ \\___\n                  |  |                    /   \\( )/   \\\n                  |  |                   /  |  \\_/  |  \\\n                  |  |                   |  |   |   |  |\n                  |  |                   |  |   |   |  |\n                  |  |                   |  |   |   |  |\n                  |  |                   |__|___|___|__|\n      ____________|  |________________   |  |_______|  |\n     /            |  |                /|  WW|   |    WW\n    /             |  |               / |    |   |\n   /              |__|              /  |    |   |\n  /                                /   |    |   |\n /                                /    |    |   |\n/________________________________/     |    |___|\n|                                |    /     /  /\n|                                |   /     /  /\n|                                |  /      |_/\n|                                | /\n|________________________________|/\n",
	"                    ___________________________________\n                   /  _________________________) )_____)\n                  /  /  / /                    | |\n                  |  | / /       /\\ /\\         | |\n                  |  |/ /          V           | |          /\\ /\\\n                  |  | /                       | |            V\n                  |  |/                        | |\n                  |  |                      ()(_)()\n                  |  |                    ()       ()\n                  |  |     /\\ /\\         ()  X   X ()\n                  |  |       V           ()(\\  __  ()\n                  |  |                    ()(\\_____|)\n                  |  |                     ___/ _ \\___\n                  |  |                    /   \\( )/   \\\n                  |  |                   /  |  \\_/  |  \\\n                  |  |                   |  |   |   |  |\n                  |  |                   |  |   |   |  |\n                  |  |                   |  |   |   |  |\n                  |  |                   |__|___|___|__|\n      ____________|  |________________   |  |_______|  |\n     /            |  |                /|  WW|       |WW\n    /             |  |               / |    |   |   |\n   /              |__|              /  |    |   |   |\n  /                                /   |    |   |   |\n /                                /    |    |   |   |\n/________________________________/     |    |___|___|\n|                                |    /     /  / \\  \\\n|                                |   /     /  /   \\  \\\n|                                |  /      |_/     \\_|\n|                                | /\n|________________________________|/\n",
};

void goUpLine() {
	printf("\033[A\033[2K");
	rewind(stdout);
}

void checkPicsFile() {
	char const* const dirname = STR(DATADIR) "/" PACKAGE;
	struct stat st;
	if(stat(dirname, &st) == 0) {
		for(unsigned int i = 1 ; i <= 10 ; ++i) {
			char filename[255];
			sprintf(filename, "%s/%d.txt", dirname, i);
			// Check if file does not exists
			if(access(filename, F_OK)) {
				havePicsFile = false;
				return;
			}
		}
		havePicsFile = true;
	} else
		havePicsFile = false;
}

struct picture getPicture(short int n) {
	if(havePicsFile) {
		char filename[255];
		sprintf(filename, STR(DATADIR) "/" PACKAGE "/%d.txt", n + 1);
		FILE* f = fopen(filename, "r");

		static char str[2048] = "";
		// Reset the string
		str[0] = '\0';
		char line[65];
		unsigned short int height = 0;
		// Read the file and count the lines
		while(fgets(line, 65, f) != NULL) {
			strcat(str, line);
			++height;
		}

		fclose(f);

		struct picture re = { str, height };
		return re;

	} else {
		struct picture re = { hardcodedPictures[n], 31 };
		return re;
	}
}
